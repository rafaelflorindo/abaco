<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>√Åbaco Interativo ‚Äî N√≠veis Ajustados</title>
  <style>
    body { box-sizing:border-box; margin:0; padding:0; height:100%; font-family:'Segoe UI'; background: linear-gradient(135deg, #667eea, #764ba2); }
    .container { text-align:center; background:#ffffff; padding:40px; border-radius:20px; max-width:800px; margin:40px auto; }
    h1{ color:#333; margin-bottom:30px; font-size:36px; }
    .instructions{ background:#f0f4ff; padding:25px; border-radius:12px; margin-bottom:30px; border:2px solid #667eea; text-align:left;}
    .abacus{ display:flex; justify-content:space-around; margin:30px 0; gap:30px; }
    .column{ display:flex; flex-direction:column; align-items:center; flex:1; }
    .column-label{ font-size:18px; font-weight:bold; color:#667eea; margin-bottom:10px; }
    .rod{ width:8px; height:350px; background:linear-gradient(#8b5cf6, #667eea); border-radius:4px; position:relative; }
    .beads-container{ position:absolute; top:0; left:50%; transform:translateX(-50%); width:100%; height:100%; display:flex; flex-direction:column-reverse; justify-content:space-around; padding:10px 0; }
    .bead{ width:50px; height:50px; background:linear-gradient(#fbbf24,#f59e0b); border-radius:50%; cursor:pointer; transition:.3s; border:3px solid #fff; display:flex; align-items:center; justify-content:center; }
    .bead.active{ background:linear-gradient(#ef4444,#dc2626); color:#fff; }
    .total-display{ margin-top:30px; padding:20px; background:linear-gradient(#667eea,#764ba2); border-radius:12px; color:#fff; }
    .button-group{ margin-top:20px; display:flex; gap:15px; justify-content:center; flex-wrap:wrap; }
    .button{ padding:12px 32px; font-size:16px; font-weight:bold; color:#fff; background:linear-gradient(#667eea,#764ba2); border:none; border-radius:8px; cursor:pointer; }
    .exercises-section{ margin-top:40px; padding:30px; background:#f8f9fa; border-radius:12px; }
    .exercise-card{ background:#fff; padding:25px; margin:20px 0; border-radius:12px; }
    .exercise-question{ font-size:24px; color:#333; margin-bottom:20px; font-weight:bold; }
    .feedback{ margin-top:15px; padding:12px; border-radius:8px; font-weight:bold; font-size:18px; display:none; }
    .feedback.correct{ background:#d1fae5; color:#065f46; display:block; }
    .feedback.wrong{ background:#fee2e2; color:#991b1b; display:block; }
    .check-button{ padding:10px 24px; font-size:16px; font-weight:bold; color:#fff; background:linear-gradient(#10b981,#059669); border:none; border-radius:8px; cursor:pointer; margin-top:15px; }
    #congrats{ display:none; font-size:26px; color:#10b981; font-weight:bold; margin-top:30px; }
  </style>
</head>

<body>
<div class="container">
  <h1>√Åbaco Interativo</h1>

  <div class="instructions">
    <h3>üìñ Como usar:</h3>
    <p>Clique nas contas para ativ√°-las. As vermelhas contam no total!</p>
  </div>

  <div class="abacus">
    <div class="column">
      <div class="column-label">Centenas</div>
      <div class="rod"><div class="beads-container" id="column1"></div></div>
    </div>
    <div class="column">
      <div class="column-label">Dezenas</div>
      <div class="rod"><div class="beads-container" id="column2"></div></div>
    </div>
    <div class="column">
      <div class="column-label">Unidades</div>
      <div class="rod"><div class="beads-container" id="column3"></div></div>
    </div>
  </div>

  <div class="total-display">
    <div>Total:</div>
    <div id="total">0</div>
  </div>

  <div class="button-group">
    <button class="button" onclick="resetAbacus()">Reiniciar √Åbaco</button>
    <button class="button" onclick="clearAbacusOnly()">Limpar √Åbaco</button>
    <button class="button" onclick="generateExercises()">Gerar Exerc√≠cios</button>
  </div>

  <div class="exercises-section">

    <div class="exercise-card">
      <div class="exercise-question">Represente o n√∫mero <strong><span id="random-num-1">0</span></strong> no √°baco</div>
      <button class="check-button" onclick="checkExercise(1)">Verificar</button>
      <div class="feedback" id="feedback1"></div>
    </div>

    <div class="exercise-card">
      <div class="exercise-question"><strong><span id="num2a">0</span></strong> + <strong><span id="num2b">0</span></strong></div>
      <button class="check-button" onclick="checkExercise(2)">Verificar</button>
      <div class="feedback" id="feedback2"></div>
    </div>

    <div class="exercise-card">
      <div class="exercise-question"><strong><span id="num3a">0</span></strong> - <strong><span id="num3b">0</span></strong></div>
      <button class="check-button" onclick="checkExercise(3)">Verificar</button>
      <div class="feedback" id="feedback3"></div>
    </div>

    <div id="congrats">üéâ PARAB√âNS! Voc√™ concluiu todos os desafios! üéâ</div>

  </div>
</div>

<script>
  const BEADS_PER_COLUMN = 9;
  let columnStates = [0,0,0];
  let exerciseAnswers = [0,0,0];
  let correctFlags = [false,false,false];

  function initializeAbacus(){
    for(let col=1; col<=3; col++){
      const container = document.getElementById(`column${col}`);
      container.innerHTML = '';
      for(let i=0;i<BEADS_PER_COLUMN;i++){
        const bead = document.createElement('div');
        bead.className = 'bead';
        bead.dataset.column = col - 1;
        bead.dataset.index = i;
        bead.onclick = () => toggleBead(bead);
        container.appendChild(bead);
      }
    }
    updateTotal();
    generateExercises();
  }

  function toggleBead(bead){
    const column = parseInt(bead.dataset.column);
    const index = parseInt(bead.dataset.index);
    const target = index + 1;
    columnStates[column] = (columnStates[column] === target) ? target - 1 : target;
    updateColumn(column);
    updateTotal();
  }

  function updateColumn(col){
    const beads = document.getElementById(`column${col+1}`).querySelectorAll('.bead');
    beads.forEach((b,i)=> b.classList.toggle('active', i < columnStates[col]));
  }

  function updateTotal(){
    const total = columnStates[0]*100 + columnStates[1]*10 + columnStates[2];
    document.getElementById('total').textContent = total;
  }

  function clearAbacusOnly(){
    columnStates = [0,0,0];
    for(let c=0; c<3; c++) updateColumn(c);
    updateTotal();
  }

  function resetAbacus(){
    clearAbacusOnly();
    correctFlags = [false,false,false];
    document.querySelectorAll('.feedback').forEach(f=>{ f.style.display="none"; f.className="feedback"; });
    document.getElementById("congrats").style.display="none";
  }

  function generateExercises(){
    resetAbacus();

    /* --- N√çVEL 1: representar n√∫mero simples --- */
    exerciseAnswers[0] = Math.floor(Math.random()*100); // 0 a 99
    document.getElementById('random-num-1').textContent = exerciseAnswers[0];

    /* --- N√çVEL 2: soma progressiva --- */
    const somaNivel = Math.floor(Math.random()*3)+1;

    let a, b;

    if(somaNivel === 1){
      a = Math.floor(Math.random()*9)+1;
      b = Math.floor(Math.random()*9)+1;
    } else if(somaNivel === 2){
      a = Math.floor(Math.random()*50)+10;
      b = Math.floor(Math.random()*50)+10;
    } else {
      a = Math.floor(Math.random()*400)+100;
      b = Math.floor(Math.random()*200)+50;
    }

    exerciseAnswers[1] = a + b;
    document.getElementById('num2a').textContent = a;
    document.getElementById('num2b').textContent = b;

    /* --- N√çVEL 3: subtra√ß√£o progressiva --- */
    const subNivel = Math.floor(Math.random()*3)+1;

    let x,y;

    if(subNivel === 1){
      x = Math.floor(Math.random()*9)+5;
      y = Math.floor(Math.random()*5)+1;
    } else if(subNivel === 2){
      x = Math.floor(Math.random()*60)+40;
      y = Math.floor(Math.random()*(x-20))+10;
    } else {
      x = Math.floor(Math.random()*400)+200;
      y = Math.floor(Math.random()*150)+50;
    }

    exerciseAnswers[2] = x-y;
    document.getElementById('num3a').textContent = x;
    document.getElementById('num3b').textContent = y;
  }

  function checkExercise(n){
    const total = columnStates[0]*100 + columnStates[1]*10 + columnStates[2];
    const correct = total === exerciseAnswers[n-1];
    const fb = document.getElementById(`feedback${n}`);

    if(correct){
      fb.className="feedback correct";
      fb.textContent="‚úì Correto!";
      correctFlags[n-1] = true;
    } else {
      fb.className="feedback wrong";
      fb.textContent="‚úó Tente novamente! (Gabarito: "+exerciseAnswers[n-1]+")";
    }
    fb.style.display="block";

    if(correctFlags.every(v=>v)) document.getElementById("congrats").style.display="block";
  }

  initializeAbacus();
</script>

</body>
</html>
